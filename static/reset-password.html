<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">

    <title>NetVest - Reset Password</title>

	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

	<script>
		var is = {}
		var code = get_code()

		is.iOS     = navigator.userAgent.match(/iPhone|iPad/i)
		is.Android = navigator.userAgent.match(/android/i)

		document.addEventListener('DOMContentLoaded', () =>
		{
			if (code)
			{
				document.querySelector('form input#code').value = code
			}

			if (is.iOS)
			{
				location = `netvest://reset-password?code=${code}`

				// fallback('http://www.apple.com/ru/itunes/')
			}
			else if (is.Android)
			{
				location = `intent://recovery/#Intent;package=com.netvest.netvestapp;scheme=netvest;S.code=${code};S.email=[email];end;`

				// fallback('https://play.google.com/store')
			}
		})

		function fallback (store)
		{
			setTimeout(function still ()
			{
				if (! isHidden())
				{
					location = store
				}
			}
			, 2000)
		}

		function isHidden ()
		{
			if (typeof document.hidden !== 'undefined')
			{
				return Boolean(document.hidden)
			}
			else if (typeof document.webkitHidden !== 'undefined')
			{
				return Boolean(document.webkitHidden)
			}
			else
			{
				return false
			}
		}

		function get_code ()
		{
			var search = window.location.search
			var query = {}

			search = search.slice(1).split('&')
			search.map((arg) =>
			{
				var key_value = arg.split('=')
				query[key_value[0]] = key_value[1]
			})

			if ('code' in query && query.code)
			{
				return query.code
			}

			return ''
		}
	</script>
</head>
<body>
<div class="container-fluid">
	<div class="row">
		<div class="col-xs-12 col-md-8 col-md-offset-2">
			<h1 class="text-center">NetVest</h1>
			<h2 class="text-center">Password Reset</h2>

			<form id="password-reset" action="/api/password/reset" method="POST">
				<div class="form-group">
					<label for="code">Code</label>
					<input type="text" class="form-control" id="code" name="code" placeholder="Code">
				</div>
				<div class="form-group">
					<label for="password">Password</label>
					<input type="password" class="form-control" id="password" name="password" placeholder="Password">
				</div>

				<button type="submit" class="btn btn-default">Submit</button>
			</form>
		</div>
	</div>
</div>
</body>
</html>
